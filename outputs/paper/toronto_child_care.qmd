---
title: "Licensed Child Care Spaces in Toronto's 25 Wards" 
subtitle: 
author: 
  - Thomas Fox
thanks: "Code and data are available at: https://github.com/ThomasWilliamFox/toronto_child_care"
date: today
date-format: long
abstract: 
"1) what was done, 2) what was found, and 3) why this matters (all at a high level). Likely four sentences. Abstract must make clear what we learn about the world because of this paper."

"Analysis of licensed child care facilities, child population, and average household income in Toronto's 25 wards. Investigation reveals a negative correlation between children per child care space and average household income by ward. This finding suggests a lack of access and equity to licensed childcare facilities based on average household income."

format: pdf
number-sections: true
toc: true
bibliography: references.bib
---

```{r}
#| include: false
#| warning: false
#| message: false
#| echo: false

library(tidyverse)
library(here)
library(knitr)
library(tinytex)
library(opendatatoronto)
library(dplyr)
library(janitor)
```

```{r}
#| include: false
#| echo: false
#| message: false

# read cleaned child care data
child_care = read_csv(
  file = here("outputs/data/child_care_data.csv"),
  show_col_types = FALSE
)

# read cleaned census data
census_data = read_csv(
  file = here("outputs/data/census_data.csv"),
  show_col_types = FALSE
)

# read cleaned merged child care/census data
 census_childcare_data = read_csv(
  file = here("outputs/data/merged_ward_data.csv"),
  show_col_types = FALSE
)

# read ward names
ward_names = read_csv(
  file = here("outputs/data/ward_names.csv"),
  show_col_types = FALSE
)
```


# Introduction
1) broader context to motivate
2) some detail about what the paper is about; 
3) a clear gap that needs to be filled; 
4) what was done; 
5) what was found; 
6) why it is important; 
7) the structure of the paper. 
A reader should be able to read only the introduction and know what was done, why, and what was found. Likely 3 or 4 paragraphs, or 10 per cent of total.

You can and should cross-reference sections and sub-sections. 

The remainder of this paper is structured as follows(@citeR). 

[@citeR]
[@tidyverse] 
[@here]
[@knitr]
[@tinytex]
[@opendatatoronto]
[@dplyr]
[@janitor]
[@plyr]

The remainder of this paper is structured as follows(@citeR). 
 

# Data {#sec-data}
A sense of the dataset should be communicated to the reader. 

The broader context of the dataset should be discussed. 

All variables should be thoroughly examined and explained. 

Explain if there were similar datasets that could have been used and why they were not. 

If variables were constructed then this should be mentioned, and high-level cleaning aspects of note should be mentioned, but this section should focus on the destination, not the journey. 

It is important to understand what the variables look like by including graphs, and possibly tables, of all observations, along with discussion of those graphs and the other features of these data. 

Summary statistics should also be included, and well as any relationships between the variables. If this becomes too detailed, then appendices could be used.
## Licensed Child Care Centres in Toronto 

The first data set I explored is... (@tbl-childcaredata) from @opendatatoronto.


```{r}
#| label: tbl-childcaredata
#| tbl-cap: Sampled of Cleaned Toronto Licensed Child Care Data
#| echo: false
#| warning: false

# Ref from https://github.com/christina-wei/INF3104-1-Covid-Clinics/blob/main/outputs/paper/covid_clinics.qmd
head(child_care, 6) |>
  kable(
    col.names = c("Facility ID", " Ward Number", "Total Spaces", "Type"),
    booktabs = TRUE
  )

```

I then visualized the total child care spots per ward (@fig-totalspots) from @opendatatoronto.


```{r}
#| label: fig-totalspots
#| fig-cap: Total number of child-care spaces by ward
#| echo: false
#| warning: false

# turn ward_names into list for graph substitution with ward numbers 
ward_name_list <- as.list(ward_names$ward_name)

# substitute ward numbers for names
census_childcare_data <-
  census_childcare_data |>
  mutate(ward = as.character(ward))

for (x in 1:25) {
  census_childcare_data$ward[census_childcare_data$ward == x] = ward_name_list[[x]]
} 

# construct graph 
child_care_graph_1 <-
  census_childcare_data|>
  ggplot(aes(x = reorder(ward, 1:25), y = total_spots)) +
  geom_bar(stat = "identity") +
  theme_minimal() +
  theme(axis.text.x = element_text(size = 7, angle = 45, vjust = 1, hjust=1))+
  labs(x = "Ward", y = "Total child care spaces")

child_care_graph_1
```


## Toronto Ward Profiles Based on 2021 Canada Census Data  

I then looked at the profiles of Toronto's 25 wards based on the 2021 Canada Census (@tbl-censusdata) from @opendatatoronto.

```{r}
#| label: tbl-censusdata
#| tbl-cap: Sample of Cleaned 2021 Canada Census Data
#| echo: false
#| warning: false

# Ref from https://github.com/christina-wei/INF3104-1-Covid-Clinics/blob/main/outputs/paper/covid_clinics.qmd
head(census_data, 6) |>
  kable(
    col.names = c("Ward Number", "Age 0-4", "Age 5-9", "Age 10-14", "Average Household Income", "Median Household Income"),
    booktabs = TRUE
  )
```


I used this data to determine what number of the population is under the age of 15 in each ward (@fig-totalchildren).


```{r}
#| label: fig-totalchildren
#| fig-cap: Population under 15 years of age by ward
#| echo: false
#| warning: false

# substitute ward numbers for names
for (x in 1:25) {
  census_data$ward[census_data$ward == x] = ward_name_list[[x]]
} 

# construct graph 
census_graph_population<-
  census_data|>
  ggplot(aes(x = reorder(ward, 1:25), y = pop_0_to_4 + pop_5_to_9 + pop_10_to_14)) +
  geom_bar(stat = "identity") +
  theme_minimal() +
  theme(axis.text.x = element_text(size = 7, angle = 45, vjust = 1, hjust=1))+
  labs(x = "Ward", y = "Population under 15 years old") 

census_graph_population
```

I then looked at what the average income was per ward (@fig-avgincome).


```{r}
#| label: fig-avgincome
#| fig-cap: Average household income by ward
#| echo: false
#| warning: false

# Construct graph 
census_graph_income <-
  census_data |>
  ggplot(aes(x = reorder(ward, avg_hh_income), y = avg_hh_income)) +
  geom_bar(stat = "identity") +
  theme_minimal() +
  theme(axis.text.x = element_text(size = 7, angle = 45, vjust = 1, hjust=1)) +
  labs(x = "Ward arranged by average household income", y = "Average household income")
census_graph_income
```
## Investigation

I then made a graph that displayed the number of child care spaces in each ward in acending order based on average household income (@fig-spacesbyincome) 


```{r}
#| label: fig-spacesbyincome
#| fig-cap: Number of child care spaces by ward (arranged by average income)
#| echo: false
#| warning: false

# Construct graph 
spaces_by_ward <- 
  census_childcare_data|>
  ggplot(aes(x = reorder(ward, avg_hh_income), y = total_spots)) +
  geom_bar(stat = "identity") +
  theme_minimal() +
  theme(axis.text.x = element_text(size = 7, angle = 45, vjust = 1, hjust=1)) +
  labs(x = "Ward arranged by average household income", y = "Child care spaces")

spaces_by_ward
```

I then constructed a scatter plot showing the number of children under the age of 14 per child care space in each ward arranged in ascending order by average household income (@fig-childrenspacesplot). 

```{r}
#| label: fig-childrenspacesplot
#| fig-cap: Number of children per child care space by ward
#| echo: false
#| warning: false

# Construct graph 
children_per_space_by_income <- 
  census_childcare_by_income |>
  ggplot(aes(x=reorder(ward, avg_hh_income), y= total_under_15/total_spots)) +
  geom_point(fill= "black", size=1, shape=23) +
  geom_smooth(mapping = aes(x=1:25, y = total_under_15/total_spots), method=lm, se=FALSE) +
  theme_minimal() +
  theme(axis.text.x = element_text(size = 7, angle = 45, vjust = 1, hjust=1)) +
  labs(x = "Ward arranged by average household income ", y = "Children per child care space") 

suppressMessages(print(children_per_space_by_income))
```


Talk more about it.

And also planes. (You can change the height and width, but don't worry about doing that until you have finished every other aspect of the paper - Quarto will try to make it look nice and the defaults usually work well once you have enough text.)


\newpage

\appendix

# Appendix {-}

```{r}
#| label: tbl-mergeddata
#| tbl-cap: Sample of Merged Licensed Child Care Centres in Toronto and Ward Profiles (2021 Census Data) used to build graphs
#| echo: false
#| warning: false

# Ref from https://github.com/christina-wei/INF3104-1-Covid-Clinics/blob/main/outputs/paper/covid_clinics.qmd

merged_data <-
  census_childcare_data |>
  select(ward, avg_hh_income, total_spots, total_under_15)

head(merged_data, 6) |>
  kable(
    col.names = c("Ward Number", "Average Household Income", "Child Care Spaces", "Population Aged 0 - 14"),
    booktabs = TRUE
  )

```


\newpage


# References


